# Система управления студентами с ZeroMQ

Клиент-серверное приложение на C++ для обработки и передачи информации о студентах с использованием протокола ZeroMQ.

## 📋 Содержание

- [Архитектура](#архитектура)
- [Требования](#требования)
- [Установка зависимостей](#установка-зависимостей)
- [Сборка проекта](#сборка-проекта)
- [Запуск](#запуск)
- [Структура проекта](#структура-проекта)
- [Описание модулей](#описание-модулей)

## 🏗️ Архитектура

### Серверная часть
1. **FileParser** - Чтение и парсинг файлов со студентами
2. **Validator** - Валидация данных (даты, имена, ID)
3. **StudentMerger** - Объединение дубликатов по ФИО и дате рождения
4. **ZmqPublisher** - Публикация данных через ZeroMQ PUB в отдельном потоке
5. **Serializer** - Сериализация/десериализация данных

### Клиентская часть
1. **ZmqSubscriber** - Получение данных через ZeroMQ SUB в отдельном потоке
2. **Serializer** - Десериализация данных
3. **Validator** - Валидация полученных данных
4. **StudentSorter** - Сортировка и отображение студентов

## 📦 Требования

- **Компилятор**: GCC 7+ или Clang 6+ с поддержкой C++17
- **ZeroMQ**: версия 4.0 или выше
- **cppzmq**: C++ биндинги для ZeroMQ
- **Операционная система**: Linux, macOS или Windows (с MinGW/WSL)

## 🔧 Установка зависимостей

### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install -y build-essential cmake
sudo apt-get install -y libzmq3-dev libzmq5
sudo apt-get install -y libczmq-dev
```

Установка cppzmq (C++ биндинги):
```bash
git clone https://github.com/zeromq/cppzmq.git
cd cppzmq
sudo make install
```

### macOS (с Homebrew)
```bash
brew install zeromq
brew install cppzmq
```

### Fedora/RHEL/CentOS
```bash
sudo dnf install gcc-c++
sudo dnf install zeromq-devel cppzmq-devel
```

## 🔨 Сборка проекта

### Вариант 1: С использованием Makefile (рекомендуется)

```bash
# Собираем проект
make

# Проверяем, что бинарники созданы
ls -la server client
```

### Вариант 2: Ручная сборка через g++

```bash
# Сборка сервера
g++ -std=c++17 -I./common -I./server \
    server/main.cpp \
    -o server -lzmq -pthread

# Сборка клиента
g++ -std=c++17 -I./common -I./client \
    client/main.cpp \
    -o client -lzmq -pthread
```

## 🚀 Запуск

### 1. Запуск сервера

В первом терминале:
```bash
./server_app
```

Сервер выполнит:
- ✅ Чтение файлов со студентами
- ✅ Валидацию данных
- ✅ Объединение дубликатов
- ✅ Публикацию через ZeroMQ на `tcp://*:5555`

### 2. Запуск клиента

Во втором терминале:
```bash
./client_app
```

Клиент выполнит:
- ✅ Подключение к серверу
- ✅ Получение данных
- ✅ Валидацию полученных данных
- ✅ Сортировку по ФИО
- ✅ Вывод на экран

### Пример вывода

**Сервер:**
```
╔════════════════════════════════════════════════════╗
║          СЕРВЕР УПРАВЛЕНИЯ СТУДЕНТАМИ              ║
╚════════════════════════════════════════════════════╝

📖 ШАГ 1: Чтение файлов со студентами

📂 Чтение файла: student_file_1.txt
✅ Обработано: 3 корректных записей
📂 Чтение файла: student_file_2.txt
✅ Обработано: 3 корректных записей

📖 ШАГ 2: Объединение списков студентов

🔄 Объединение списков студентов...
   🔗 Дубликат найден: Ivan Ivanovich Ivanov (ID объединены)
✅ Объединение завершено: 5 уникальных студентов

📖 ШАГ 3: Публикация данных через ZeroMQ

📡 Publisher запущен на tcp://*:5555
📤 Отправка данных (5 студентов)...
```

**Клиент:**
```
╔════════════════════════════════════════════════════╗
║          КЛИЕНТ УПРАВЛЕНИЯ СТУДЕНТАМИ              ║
╚════════════════════════════════════════════════════╝

📖 ШАГ 1: Подключение к серверу

📡 Subscriber запущен, подключение к tcp://localhost:5555
📥 Данные получены (245 байт)
✅ Десериализовано 5 студентов

📖 ШАГ 2: Обработка полученных данных
📖 ШАГ 3: Сортировка студентов по ФИО

======================================================================
📋 СПИСОК СТУДЕНТОВ (5)
======================================================================
ID             ФИО                                Дата рождения
----------------------------------------------------------------------
23             Denis Denisovich Denisov           04.03.1988
1, 34          Ivan Ivanovich Ivanov              01.01.1988
54             Petr Petrovich Kazakov             05.07.1986
2              Petr Petrovich Petrov              04.07.1988
5              Vladimir Vladimirovich Kochkin     11.10.1989
======================================================================
```

## 📁 Структура проекта

```
project/
├── CMakeLists.txt              # Конфигурация сборки
├── README.md                   # Документация
├── student_file_1.txt          # Тестовые данные
├── student_file_2.txt          # Тестовые данные
│
├── common/                     # Общие модули
│   ├── Student.h               # Структура данных студента
│   ├── Validator.h             # Валидация данных
│   └── Serializer.h            # Сериализация/десериализация
│
├── server/                     # Серверная часть
│   ├── main.cpp                # Главный файл сервера
│   ├── FileParser.h            # Парсинг файлов
│   ├── StudentMerger.h         # Объединение студентов
│   └── ZmqPublisher.h          # ZeroMQ Publisher
│
└── client/                     # Клиентская часть
    ├── main.cpp                # Главный файл клиента
    ├── ZmqSubscriber.h         # ZeroMQ Subscriber
    └── StudentSorter.h         # Сортировка и вывод
```

## 🔍 Описание модулей

### Common (Общие модули)

#### Student.h
- Структура данных для представления студента
- Поля: ID (вектор), имя, отчество, фамилия, дата рождения
- Методы сравнения и получения уникального ключа

#### Validator.h
Валидация входных данных:
- ✅ Проверка корректности дат (високосные годы, диапазоны)
- ✅ Валидация имен (только буквы, не пусто)
- ✅ Проверка ID (положительные числа)
- ✅ Парсинг дат формата DD.MM.YYYY
- ⚠️ Вывод понятных сообщений об ошибках

#### Serializer.h
Сериализация для передачи по сети:
- Формат: `ID1,ID2|FirstName|MiddleName|LastName|DD.MM.YYYY`
- Методы: `serialize()` и `deserialize()`
- Валидация при десериализации

### Server (Серверные модули)

#### FileParser.h
Чтение и парсинг файлов:
- Построчное чтение файлов
- Парсинг формата: `ID FirstName MiddleName LastName DD.MM.YYYY`
- Валидация каждой записи
- Статистика обработки

#### StudentMerger.h
Объединение студентов:
- Идентификация дубликатов по ФИО + дата рождения
- Объединение ID дубликатов
- Map-based реализация для эффективности

#### ZmqPublisher.h
Публикация данных:
- ✅ Работа в отдельном потоке
- ✅ ZeroMQ PUB сокет
- ✅ Топик "students"
- ✅ Множественная отправка для надежности
- ✅ Неблокирующая работа

### Client (Клиентские модули)

#### ZmqSubscriber.h
Получение данных:
- ✅ Работа в отдельном потоке
- ✅ ZeroMQ SUB сокет
- ✅ Подписка на топик "students"
- ✅ Timeout и повторные попытки
- ✅ Потокобезопасное хранение данных

#### StudentSorter.h
Сортировка и вывод:
- Сортировка по полному имени (ФИО)
- Форматированный вывод в виде таблицы
- Отображение всех ID студента

## ⚙️ Особенности реализации

### Многопоточность
- ✅ Publisher и Subscriber работают в отдельных потоках
- ✅ Использование `std::thread` и `std::atomic`
- ✅ Потокобезопасность через `std::mutex`
- ✅ Основной поток не блокируется

### Валидация данных
- ✅ Проверка на всех этапах обработки
- ✅ Детальные сообщения об ошибках
- ✅ Отсеивание некорректных записей
- ✅ Статистика обработки

### Надежность
- ✅ Обработка ошибок ZeroMQ
- ✅ Timeout при получении данных
- ✅ Множественная отправка сообщений
- ✅ Валидация после десериализации

## 🐛 Устранение неполадок

### Ошибка: "Cannot open file"
- Убедитесь, что файлы `student_file_1.txt` и `student_file_2.txt` находятся в текущей директории
- Проверьте права доступа к файлам

### Ошибка: "ZMQ error: Address already in use"
- Порт 5555 уже занят другим процессом
- Измените порт в коде или завершите процесс, использующий порт

### Клиент не получает данные
- Запустите сервер ДО клиента
- Проверьте, что нет firewall блокирующего порт 5555
- Убедитесь, что используется правильный адрес (localhost/127.0.0.1)

### Ошибки компиляции
- Убедитесь, что установлены все зависимости
- Проверьте версию компилятора (нужен C++17)
- Попробуйте обновить cppzmq до последней версии

## 📝 Формат входных файлов

```
ID FirstName MiddleName LastName DD.MM.YYYY
```

Пример:
```
1 Ivan Ivanovich Ivanov 01.01.1988
2 Petr Petrovich Petrov 15.07.1990
```

Требования:
- ID - положительное целое число
- Имена - только буквы (латиница или кириллица)
- Дата - формат DD.MM.YYYY, корректная календарная дата
- Разделитель - пробел